# Використання клієнту Elasticsearch(.js)

# Встановлення ES

Для цього нам спочатку потрібно Java. Розробники рекомендують встановити версії Java новіше, ніж Java 8 update 20 або Java 7 update 55.
Дистрибутив ES доступний на сайті розробника. Після розпакування архіву потрібно запустити bin/elasticsearch.
Після установки і запуску перевіримо працездатність:

export ES_URL=localhost:9200

curl -X GET $ES_URL

Ми отримаємо приблизно таку відповідь:

![image](https://user-images.githubusercontent.com/61386231/111884743-34606b80-89cc-11eb-9e4d-b6693a56c5a7.png)

# Індексація

Додамо пост в ES:

#/ Додамо документ c id 1 типу post в індекс blog.

#/ Pretty вказує, що висновок повинен бути придатним для читання людиною.


PUT /blog/post/1?pretty

{
  "title": "Доповідь з ІПЗ",
  
  "content": "<p>Історія про довгу підготовку доповіді<p>",
  
  "tags": [
  
    "доповідь",
    
    "ІПЗ"
  ],
  
  "published_at": "2021-03-15T20:44:42+00:00"
  
}


Отримаємо таку відповідь серверу:

![image](https://user-images.githubusercontent.com/61386231/112749346-70965c00-8fca-11eb-965b-7e615f4df9c1.png)

ES автоматично створив індекс blog і тип post. Можна провести умовну аналогію: індекс - це база даних, а тип - таблиця в цій БД. Кожен тип має свою схему - mapping, також як і реляційна таблиця. Mapping генерується автоматично при індексації документа:

#/ Отримаємо mapping всіх типів індексу blog

GET /blog/_mapping?pretty

відповідь серверу:

![image](https://user-images.githubusercontent.com/61386231/112749395-cbc84e80-8fca-11eb-941c-2aa2d0dea70f.png)

Варто відзначити, що ES не робить різниці між поодиноким значенням і масивом значень. Наприклад, поле title містить просто заголовок, а поле tags - масив рядків, хоча вони представлені в mapping однаково.

# Запити

# Витяг документа по його id:

#/ Винесемо документ з id 1 типу post з індексу blog

![image](https://user-images.githubusercontent.com/61386231/112760110-8c1b5a00-8ffe-11eb-8756-e4c103657d62.png)

У відповіді з'явилися нові ключі: _version і _source. Взагалі, всі ключі, що починаються з _ відносяться до службових.


Ключ _version показує версію документа. Він потрібен для роботи механізму оптимістичних блокувань. Наприклад, ми хочемо змінити документ, що має версію 1. Ми відправляємо змінений документ і вказуємо, що це правка документа з версією 1. Якщо хтось інший теж редагував документ з версією 1 і відправив зміни раніше нас, то ES не прийме наші зміни, тому він зберігає документ з версією 2.


Ключ _source містить той документ, який ми індексували. ES не використовує це значення для пошукових операцій, тому що для пошуку використовуються індекси. Для економії місця ES зберігає стислий вихідний документ. Якщо нам потрібен тільки id, а не весь вихідний документ, то можна відключити зберігання исходника.


Якщо нам не потрібна додаткова інформація, можна отримати тільки вміст _source:

GET /blog/post/1/_source?pretty

![image](https://user-images.githubusercontent.com/61386231/112760161-be2cbc00-8ffe-11eb-834a-8f4ecc0eb878.png)



